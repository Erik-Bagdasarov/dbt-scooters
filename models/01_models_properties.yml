version: 2

models:
  - name: "trips_stat_daily"
    description: "Overall trips statistics per day"
    config:
      indexes:
        - columns: [ "date" ]

  - name: "trips_stat"
    description: "Overall trips statistics"
    config:
      materialized: "view"

  - name: "trips_prep"
    description: "Trips prepared for analysis"
    config:
      materialized: "view"
    data_tests:
      - row_count_equal:
          compare_model: "source('scooters_raw', 'trips')"

  - name: "trips_age_daily"
    description: "Daily trips statistics by users age"

  - name: "trips_age_daily_stat"
    description: "Aggregation of daily trips statistics by user age"
    
  - name: "trips_geom"
    description: "Trips prepared for geometry analysis"
    config:
      materialized: "view"

  - name: "parking_start_stat"
    description: "Trip start parking statistics by 500 m hexagons"

  - name: "parking_finish_stat"
    description: "Trip finish parkibg statistics by 10 m hexagons"

  - name: "trips_users"
    description: "Prepared trips enriched with users data"
    config:
      materialized: "incremental"

  - name: "events_clean"
    description: "User evnets without duplicates"
    config:
      materialized: "incremental"
      strategy: "merge"

  - name: "trips_concurrency"
    description: "Number of simultaneous rides in time"
    config:
      materialized: "incremental"

  - name: "companies"
    description: "Scooter statistics by company"

  - name: "events_full"
    description: "User events enriched with meaningful types"
    config:
      materialized: "view"

  - name: "events_stream"
    description: "User events prepared for product analysis"
    config:
      materialized: "ephemeral"

  - name: "events_stat"
    description: "Overall user event statistics"

  - name: "trips_age_group"
    description: "Overall trips statistics by user age group"

  - name: "sex_age_pivot"
    description: "Trips per age pivoted by sex"
    data_tests:
      - unique_key:
          columns: ["age"]
      - dbt_expectations.expect_table_column_count_to_equal:
          value: 3
    columns:
      - name: "age"
        descriptions: "Numerical age of user"
        data_test:
          - "dbt_utils.not_constrain"

  - name: "book_scooter_retention"
    description: >
      Retention analysis which tells how many people
      started search for scooter and finally booked it on or after
      1, 7, 14 days (or weeks, months, years), etc

  - name: "metricflow_time_spine"
    description: "Time spine calendar for metricflow"
